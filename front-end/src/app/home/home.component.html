<!-- Spinner while loading -->
<div class="flex items-center justify-center h-screen" *ngIf="spinnerSite">
  <div class="spin"></div>
</div>

<!-- Content after loading -->
<div class="p-6 bg-gradient-to-br from-blue-100 to-blue-50 min-h-screen" *ngIf="!spinnerSite">

  <!-- Back button -->
  <button routerLink="/projects"
    class="cursor-pointer mb-4 inline-flex items-center text-blue-600 hover:underline text-sm">
    ← Back to projects
  </button>

  <!-- Grid or Empty State -->
  <ng-container *ngIf="sites.length > 0; else noSites">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      <div class="bg-white rounded-2xl shadow-xl p-6 transition hover:shadow-2xl hover:scale-[1.01] duration-300"
        *ngFor="let site of sites">

        <!-- Header Info -->
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-2xl font-bold text-gray-800">{{ site.nom }}</h2>
            <p class="text-sm text-gray-500">{{ site.ip }}</p>
          </div>
          <app-site-status [ip]="site.ip"></app-site-status>
        </div>

        <!-- Project Tag below -->
        <div class="mb-4">
          <span *ngIf="site.project?.nom; else noProject"
            class="inline-block bg-blue-100 text-blue-800 text-xs font-medium px-3 py-1 rounded-full border border-blue-200">
            {{ site.project.nom }}
          </span>
          <ng-template #noProject>
            <span class="text-xs text-gray-400 italic">Pas de projet</span>
          </ng-template>
        </div>

    

        <!-- Site Data Component -->
        <app-site-data [idSite]="site._id"></app-site-data>
            <!-- Links vers les composants -->
             
        <div class="mt-5 flex flex-wrap gap-2 mb-4 text-sm">
          <a [href]="'http://' + site.ip + ':9191/'" target="_blank"
             class="px-3 py-1 rounded-full bg-violet-100 text-violet-700 hover:bg-violet-200 transition">📡 Modem</a>

          <a [href]="'http://' + site.ip + ':888/'" target="_blank"
             class="px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 hover:bg-emerald-200 transition">🎥 Caméra</a>

          <a [href]="'http://' + site.ip + ':333/'" target="_blank"
             class="px-3 py-1 rounded-full bg-amber-100 text-amber-700 hover:bg-amber-200 transition">🔌 Web Relay</a>

          <a [href]="'http://' + site.ip + ':4444/'" target="_blank"
             class="px-3 py-1 rounded-full bg-blue-100 text-blue-700 hover:bg-blue-200 transition">📊 EMC</a>

          <a [href]="'http://' + site.ip + ':666/'" target="_blank"
             class="px-3 py-1 rounded-full bg-rose-100 text-rose-700 hover:bg-rose-200 transition">⚙️ ShtuttgardtM64</a>

          <a [href]="'https://' + site.ip + ':5000/'" target="_blank"
             class="px-3 py-1 rounded-full bg-slate-100 text-slate-700 hover:bg-slate-200 transition">📡 Capteur Bluetooth</a>
        </div>
      </div>

    </div>
  </ng-container>

  <!-- 👇 Empty State Template -->
  <ng-template #noSites>
    <div class="flex flex-col items-center justify-center h-96 text-center text-gray-600">
      <svg class="w-16 h-16 mb-4 text-blue-300" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M9 17v-6a2 2 0 012-2h2a2 2 0 012 2v6m-6 0h6m-6 0a2 2 0 01-2-2v-6a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2m-6 0v1a2 2 0 002 2h2a2 2 0 002-2v-1" />
      </svg>
      <h3 class="text-lg font-semibold mb-2">Aucune Station trouvé</h3>
      <p class="text-sm">Aucune station n’est disponible pour ce projet actuellement.</p>
    </div>
  </ng-template>
</div>
